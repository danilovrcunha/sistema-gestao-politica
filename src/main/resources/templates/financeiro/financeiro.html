<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro</title>
    <link rel="stylesheet" href="/global/style.css">
    <link rel="stylesheet" href="/AssistenteIA/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
<div class="container">
    <aside class="sidebar">
        <div class="logo"><h1>Menu Principal</h1></div>
        <nav class="nav-menu">
            <ul>
                <li id="menu-dashboard"><a href="/home"><i class="fas fa-home"></i> Dashboard</a></li>
                <li id="menu-acoes"><a href="/acoes"><i class="fas fa-chart-line"></i> Ações</a></li>
                <li id="menu-kanban"><a href="/kanban"><i class="fas fa-tasks"></i> Gestão de Tarefas</a></li>
                <li id="menu-financeiro" class="active"><a href="/financeiro"><i class="fas fa-dollar-sign"></i> Financeiro</a></li>
                <li id="menu-config"><a href="/configuracoes"><i class="fas fa-cog"></i> Configurações</a></li>
                <li id="assistant-toggle-btn"><a href="#"><i class="fas fa-robot"></i> Assistente IA</a></li>
            </ul>
        </nav>
        <div class="logout"><a href="/login/login.html"><i class="fas fa-sign-out-alt"></i> Sair</a></div>
    </aside>

    <main class="main-content">
        <header class="header">
            <div class="header-title">
                <i class="fas fa-dollar-sign"></i>
                <h2>Financeiro</h2>
            </div>
            <div class="header-breadcrumb">
                <p>Gerencie informações financeiras</p>
            </div>
        </header>

        <div th:if="${mensagemSucesso}" class="alert-box success">
            <div class="alert-content">
                <i class="fas fa-check-circle"></i>
                <span th:text="${mensagemSucesso}"></span>
            </div>
            <button onclick="this.parentElement.remove()" class="close-alert">&times;</button>
        </div>

        <section class="financeiro-container">
            <div class="form-header-financeiro">
                <h3>Novo Registro Financeiro</h3>
                <button type="button" class="export-btn"><i class="fas fa-file-export"></i> EXPORTAR</button>
            </div>

            <form method="POST" action="/financeiro" id="registroFinanceiroForm" class="registro-financeiro-form">
                <div class="form-group-row">
                    <div class="form-group">
                        <label for="dataRegistro">Data de Registro</label>
                        <input type="date" id="dataRegistro" name="dataRegistro" required>
                    </div>
                    <div class="form-group">
                        <label for="valorDespesa">Valor da Despesa</label>
                        <input type="text" id="valorDespesa" name="valorDespesa" placeholder="R$ 0,00" required>
                    </div>
                </div>

                <div class="form-group-row">
                    <div class="form-group">
                        <label for="tipoTransacao">Tipo:</label>
                        <select id="tipoTransacao" name="tipoTransacao" required>
                            <option value="">Selecione o Tipo</option>
                            <option value="Crédito">Crédito</option>
                            <option value="Débito">Débito</option>
                            <option value="PIX">PIX</option>
                            <option value="Dinheiro">Dinheiro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="categoria">Categoria</label>
                        <input type="text" id="categoria" name="categoria" placeholder="Ex: Combustível, Aluguel">
                    </div>
                </div>

                <div class="form-group">
                    <label for="descricao">Descrição</label>
                    <textarea id="descricao" name="descricao" rows="3" placeholder="Detalhes (opcional)"></textarea>
                </div>

                <div class="form-footer-buttons-financeiro">
                    <button type="submit" class="action-btn salvar-btn">Salvar Informações</button>
                </div>
            </form>
        </section>

        <section class="historico-transacoes-container">

            <div class="filter-bar">
                <h3>Histórico Financeiro</h3>
                <div class="filter-controls">
                    <div class="input-icon-wrapper">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="month" id="filtroMesInput" th:value="${mesSelecionado}">
                    </div>
                    <button id="btnFiltrarMes" class="btn-filter" title="Filtrar por Mês">
                        <i class="fas fa-filter"></i> Filtrar
                    </button>
                    <button id="btnLimparFiltro" class="btn-reload" title="Limpar Filtro / Recarregar">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>

            <div class="historico-header">
                <span>Registro (Mês)</span>
                <span>Custos</span>
            </div>

            <th:block th:each="registro : ${registros}">
                <div class="acordeao-item">
                    <button class="acordeao-header">
                        <span class="acordeao-titulo"
                              th:text="${(#strings.isEmpty(registro.categoria) ? 'Sem categoria' : registro.categoria) +
                                         ' (' +
                                         #strings.capitalize(#temporals.format(registro.dataRegistro, 'MMMM', new java.util.Locale('pt', 'BR'))) +
                                         ')'}">
                        </span>
                        <span class="acordeao-valor" th:text="${registro.valorFormatado}"></span>
                        <i class="fas fa-chevron-down acordeao-icon"></i>
                    </button>

                    <div class="acordeao-body">
                        <ul class="transacao-detalhes">
                            <li>
                                <span>Data exata:</span>
                                <span th:text="${#temporals.format(registro.dataRegistro, 'dd/MM/yyyy')}"></span>
                            </li>
                            <li><span>Tipo:</span> <span th:text="${registro.tipoTransacao}"></span></li>
                            <li><span>Categoria:</span> <span th:text="${registro.categoria}"></span></li>
                            <li><span>Descrição:</span> <span th:text="${registro.descricao}"></span></li>
                            <li class="total-geral">
                                <span>Valor Total:</span>
                                <span th:text="${registro.valorFormatado}"></span>
                            </li>
                        </ul>

                        <div class="acordeao-footer">
                            <button class="btn-excluir-financa action-btn"
                                    th:attr="onclick='deletarFinanceiro(' + ${registro.id} + ')'">
                                <i class="fas fa-trash-alt"></i> Excluir Registro
                            </button>
                        </div>
                    </div>
                </div>
            </th:block>

            <div th:if="${#lists.isEmpty(registros)}" class="sem-registros">
                <i class="fas fa-folder-open" style="font-size: 2em; margin-bottom: 10px; display: block;"></i>
                <p>Nenhum registro encontrado.</p>
            </div>
        </section>
    </main>
</div>
<div class="assistant-chat-panel" id="assistantChatPanel">
    <div class="chat-header">
        <h4>Assistente I.A.</h4>
        <button class="close-chat-btn" id="closeChatBtn">&times;</button>
    </div>

    <div class="chat-body" id="chatBody">
        <div class="chat-message-ai">
            Olá! Sou seu assistente de gerenciamento. Como posso te ajudar hoje?
        </div>
    </div>

    <div class="chat-footer">
        <input type="text" id="chatInput" placeholder="Digite sua mensagem...">
        <button id="sendChatBtn" class="send-chat-btn">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>


<script src="/global/script.js"></script>
<script src="/fin/script.js"></script>
<script src="/AssistenteIA/script.js" defer></script>
</body>
</html>